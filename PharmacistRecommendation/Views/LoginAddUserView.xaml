<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="PharmacistRecommendation.Views.LoginAddUserView"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:PharmacistRecommendation.ViewModels"
             x:DataType="viewmodels:LoginAddUserViewModel"
             Title="Recomandarea Farmacistului - Autentificare"
             Shell.NavBarIsVisible="False"
             BackgroundColor="#fdfdfd">

	<Grid RowDefinitions="Auto, *">

		<!-- Top Navigation Bar -->
		<Border Grid.Row="0"
                BackgroundColor="#34495E"
                Padding="15,10">
			<Label Text="Recomandarea Farmacistului"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center" />
		</Border>

		<!-- Main Content -->
		<ScrollView Grid.Row="1">
			<Grid RowDefinitions="Auto, *, Auto"
                  Padding="15,10,15,10"
                  RowSpacing="10"
                  VerticalOptions="Center">

				<!-- Header Section -->
				<StackLayout Grid.Row="0" Spacing="5">
                    <Image Source="logo.png"
           WidthRequest="130"
           HeightRequest="130"
           Aspect="AspectFit"
           HorizontalOptions="Center"/>
					<Label Text="Autentificare și Înregistrare"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="#2C3E50"
                           HorizontalOptions="Center" />
					<Label Text="Sistemul de recomandări pentru farmacii"
                           FontSize="12"
                           TextColor="#7F8C8D"
                           HorizontalOptions="Center" />
				</StackLayout>

				<!-- Main Content Form -->
				<Border Grid.Row="1"
                        StrokeThickness="1"
                        Stroke="#DDDDDD"
                        BackgroundColor="White"
                        StrokeShape="RoundRectangle 10,10,10,10"
                        Padding="20,15"
                        VerticalOptions="Center"
                        MaximumWidthRequest="500">

					<StackLayout Spacing="10">

						<!-- Mode Toggle Buttons -->
						<Grid ColumnDefinitions="*, *" ColumnSpacing="6">
							<Button Grid.Column="0"
                                    Text="Autentificare"
                                    BackgroundColor="#3498DB"
                                    TextColor="White"
                                    FontSize="12"
                                    FontAttributes="Bold"
                                    CornerRadius="6"
                                    HeightRequest="35"
                                    Command="{Binding ToggleModeCommand}">
								<Button.Triggers>
									<DataTrigger TargetType="Button" Binding="{Binding IsLoginMode}" Value="False">
										<Setter Property="BackgroundColor" Value="#95A5A6" />
										<Setter Property="TextColor" Value="White" />
									</DataTrigger>
								</Button.Triggers>
							</Button>

							<Button Grid.Column="1"
                                    Text="Adăugare Utilizator"
                                    BackgroundColor="#95A5A6"
                                    TextColor="White"
                                    FontSize="12"
                                    FontAttributes="Bold"
                                    CornerRadius="6"
                                    HeightRequest="35"
                                    Command="{Binding ToggleModeCommand}">
								<Button.Triggers>
									<DataTrigger TargetType="Button" Binding="{Binding IsLoginMode}" Value="False">
										<Setter Property="BackgroundColor" Value="#3498DB" />
										<Setter Property="TextColor" Value="White" />
									</DataTrigger>
								</Button.Triggers>
							</Button>
						</Grid>

						<!-- Login Form -->
						<StackLayout Spacing="10" IsVisible="{Binding IsLoginMode}">

							<!-- Username Entry -->
							<StackLayout Spacing="3">
								<Label Text="Nume utilizator" FontSize="12" TextColor="#7F8C8D" />
								<Border StrokeThickness="1"
                                       Stroke="#BDC3C7"
                                       BackgroundColor="#FAFAFA"
                                       StrokeShape="RoundRectangle 6,6,6,6"
                                       Padding="12,0"
                                       HeightRequest="40">
									<Entry Text="{Binding LoginUsername}"
                                           Placeholder="Introduceți numele de utilizator"
                                           FontSize="13"
                                           BackgroundColor="Transparent"
                                           TextColor="#2C3E50"
                                           PlaceholderColor="#7F8C8D"
                                           VerticalOptions="Center"
                                           ReturnType="Next" />
								</Border>
							</StackLayout>

							<!-- Password Entry -->
							<StackLayout Spacing="3">
								<Label Text="Parolă" FontSize="12" TextColor="#7F8C8D" />
								<Border StrokeThickness="1"
                                       Stroke="#BDC3C7"
                                       BackgroundColor="#FAFAFA"
                                       StrokeShape="RoundRectangle 6,6,6,6"
                                       Padding="12,0"
                                       HeightRequest="40">
									<Entry Text="{Binding LoginPassword}"
                                           Placeholder="Introduceți parola"
                                           FontSize="13"
                                           BackgroundColor="Transparent"
                                           TextColor="#2C3E50"
                                           PlaceholderColor="#7F8C8D"
                                           VerticalOptions="Center"
                                           IsPassword="True"
                                           ReturnType="Done"
                                           ReturnCommand="{Binding LoginCommand}" />
								</Border>
							</StackLayout>

							<!-- Login Error Message -->
							<Label Text="{Binding LoginErrorMessage}"
                                   TextColor="#E74C3C"
                                   FontSize="11"
                                   HorizontalOptions="Center"
                                   IsVisible="{Binding HasLoginError}" />

							<!-- Login Button -->
							<Button Text="Autentificare"
                                    Command="{Binding LoginCommand}"
                                    BackgroundColor="#2ECC71"
                                    TextColor="White"
                                    FontSize="13"
                                    FontAttributes="Bold"
                                    CornerRadius="6"
                                    HeightRequest="35"
                                    IsEnabled="{Binding IsNotLoginLoading}" />

							<!-- Login Loading Indicator -->
							<ActivityIndicator IsRunning="{Binding IsLoginLoading}"
                                               IsVisible="{Binding IsLoginLoading}"
                                               Color="#2ECC71"
                                               HorizontalOptions="Center" />

							<!-- Forgot Password -->
							<Button Text="Ați uitat parola?"
                                    Command="{Binding ForgotPasswordCommand}"
                                    BackgroundColor="Transparent"
                                    TextColor="#95A5A6"
                                    FontSize="11"
                                    HeightRequest="25"
                                    HorizontalOptions="Center" />

						</StackLayout>

						<!-- Add User Form -->
						<StackLayout Spacing="8">
							<StackLayout.Triggers>
								<DataTrigger TargetType="StackLayout" Binding="{Binding IsLoginMode}" Value="True">
									<Setter Property="IsVisible" Value="False" />
								</DataTrigger>
							</StackLayout.Triggers>

							<VerticalStackLayout Spacing="5">
								<Label Text="Nu este adăugată nicio farmacie. Adăugați mai întâi o farmacie."
                                       TextColor="#E74C3C"
                                       FontSize="11"
                                       IsVisible="{Binding HasNoPharmacy}" />

								<Button Text="Adăugare farmacie"
                                        Command="{Binding AddPharmacyCommand}"
                                        BackgroundColor="#34495E"
                                        TextColor="White"
                                        FontSize="11"
                                        FontAttributes="Bold"
                                        CornerRadius="6"
                                        HeightRequest="30"
                                        WidthRequest="130"
                                        HorizontalOptions="Start"
                                        IsVisible="{Binding HasNoPharmacy}" />
							</VerticalStackLayout>

							<!-- Name Fields -->
							<Grid ColumnDefinitions="*, *" ColumnSpacing="6">
								<StackLayout Grid.Column="0" Spacing="3">
									<Label Text="Prenume" FontSize="11" TextColor="#7F8C8D" />
									<Border StrokeThickness="1" Stroke="#BDC3C7" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 6,6,6,6" Padding="10,0" HeightRequest="36">
										<Entry Text="{Binding FirstName}"
                                               Placeholder="Prenume"
                                               FontSize="12"
                                               BackgroundColor="Transparent"
                                               TextColor="#2C3E50"
                                               PlaceholderColor="#7F8C8D"
                                               VerticalOptions="Center" />
									</Border>
								</StackLayout>
								<StackLayout Grid.Column="1" Spacing="3">
									<Label Text="Nume" FontSize="11" TextColor="#7F8C8D" />
									<Border StrokeThickness="1" Stroke="#BDC3C7" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 6,6,6,6" Padding="10,0" HeightRequest="36">
										<Entry Text="{Binding LastName}"
                                               Placeholder="Nume"
                                               FontSize="12"
                                               BackgroundColor="Transparent"
                                               TextColor="#2C3E50"
                                               PlaceholderColor="#7F8C8D"
                                               VerticalOptions="Center" />
									</Border>
								</StackLayout>
							</Grid>

							<!-- Email -->
							<StackLayout Spacing="3">
								<Label Text="Email" FontSize="11" TextColor="#7F8C8D" />
								<Border StrokeThickness="1" Stroke="#BDC3C7" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 6,6,6,6" Padding="10,0" HeightRequest="36">
									<Entry Text="{Binding Email}"
                                           Placeholder="email@example.com"
                                           FontSize="12"
                                           BackgroundColor="Transparent"
                                           TextColor="#2C3E50"
                                           PlaceholderColor="#7F8C8D"
                                           VerticalOptions="Center"
                                           Keyboard="Email" />
								</Border>
							</StackLayout>

							<!-- Phone and NCM -->
							<Grid ColumnDefinitions="*, *" ColumnSpacing="6">
								<StackLayout Grid.Column="0" Spacing="3">
									<Label Text="Telefon" FontSize="11" TextColor="#7F8C8D" />
									<Border StrokeThickness="1" Stroke="#BDC3C7" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 6,6,6,6" Padding="10,0" HeightRequest="36">
										<Entry Text="{Binding Phone}"
                                               Placeholder="0123456789"
                                               FontSize="12"
                                               BackgroundColor="Transparent"
                                               TextColor="#2C3E50"
                                               PlaceholderColor="#7F8C8D"
                                               VerticalOptions="Center"
                                               Keyboard="Telephone" />
									</Border>
								</StackLayout>
								<StackLayout Grid.Column="1" Spacing="3">
									<Label Text="NCM" FontSize="11" TextColor="#7F8C8D" />
									<Border StrokeThickness="1" Stroke="#BDC3C7" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 6,6,6,6" Padding="10,0" HeightRequest="36">
										<Entry Text="{Binding Ncm}"
                                               Placeholder="NCM"
                                               FontSize="12"
                                               BackgroundColor="Transparent"
                                               TextColor="#2C3E50"
                                               PlaceholderColor="#7F8C8D"
                                               VerticalOptions="Center" />
									</Border>
								</StackLayout>
							</Grid>

							<!-- Username and Role -->
							<Grid ColumnDefinitions="*, *" ColumnSpacing="6">
								<StackLayout Grid.Column="0" Spacing="3">
									<Label Text="Nume utilizator" FontSize="11" TextColor="#7F8C8D" />
									<Border StrokeThickness="1" Stroke="#BDC3C7" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 6,6,6,6" Padding="10,0" HeightRequest="36">
										<Entry Text="{Binding Username}"
                                               Placeholder="username"
                                               FontSize="12"
                                               BackgroundColor="Transparent"
                                               TextColor="#2C3E50"
                                               PlaceholderColor="#7F8C8D"
                                               VerticalOptions="Center" />
									</Border>
								</StackLayout>
								<StackLayout Grid.Column="1" Spacing="3">
									<Label Text="Rol" FontSize="11" TextColor="#7F8C8D" />
									<Border StrokeThickness="1" Stroke="#BDC3C7" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 6,6,6,6" Padding="10,0" HeightRequest="36">
										<Picker ItemsSource="{Binding AvailableRoles}"
                                                SelectedItem="{Binding SelectedRole}"
                                                FontSize="12"
                                                BackgroundColor="Transparent"
                                                TextColor="#2C3E50"
                                                VerticalOptions="Center" />
									</Border>
								</StackLayout>
							</Grid>

							<!-- Password Fields -->
							<Grid ColumnDefinitions="*, *" ColumnSpacing="6">
								<StackLayout Grid.Column="0" Spacing="3">
									<Label Text="Parolă" FontSize="11" TextColor="#7F8C8D" />
									<Border StrokeThickness="1" Stroke="#BDC3C7" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 6,6,6,6" Padding="10,0" HeightRequest="36">
										<Entry Text="{Binding Password}"
                                               Placeholder="Parola"
                                               FontSize="12"
                                               BackgroundColor="Transparent"
                                               TextColor="#2C3E50"
                                               PlaceholderColor="#7F8C8D"
                                               VerticalOptions="Center"
                                               IsPassword="True" />
									</Border>
								</StackLayout>
								<StackLayout Grid.Column="1" Spacing="3">
									<Label Text="Confirmă parola" FontSize="11" TextColor="#7F8C8D" />
									<Border StrokeThickness="1" Stroke="#BDC3C7" BackgroundColor="#FAFAFA" StrokeShape="RoundRectangle 6,6,6,6" Padding="10,0" HeightRequest="36">
										<Entry Text="{Binding ConfirmPassword}"
                                               Placeholder="Confirmă parola"
                                               FontSize="12"
                                               BackgroundColor="Transparent"
                                               TextColor="#2C3E50"
                                               PlaceholderColor="#7F8C8D"
                                               VerticalOptions="Center"
                                               IsPassword="True" />
									</Border>
								</StackLayout>
							</Grid>

							<!-- Add User Error Message -->
							<Label Text="{Binding AddUserErrorMessage}"
                                   TextColor="#E74C3C"
                                   FontSize="11"
                                   HorizontalOptions="Center"
                                   IsVisible="{Binding HasAddUserError}" />

							<!-- Add User Button -->
							<Button Text="Adăugare Utilizator"
                                    Command="{Binding AddUserCommand}"
                                    BackgroundColor="#2ECC71"
                                    TextColor="White"
                                    FontSize="13"
                                    FontAttributes="Bold"
                                    CornerRadius="6"
                                    HeightRequest="35"
                                    IsEnabled="{Binding IsNotAddUserLoading}" />

							<!-- Add User Loading Indicator -->
							<ActivityIndicator IsRunning="{Binding IsAddUserLoading}"
                                               IsVisible="{Binding IsAddUserLoading}"
                                               Color="#2ECC71"
                                               HorizontalOptions="Center" />

						</StackLayout>

					</StackLayout>
				</Border>

				<!-- Footer -->
				<StackLayout Grid.Row="2"
                             VerticalOptions="End"
                             Margin="0,5">
					<Label Text="© 2025 PharmacistRecommendation"
                           TextColor="#95A5A6"
                           FontSize="10"
                           HorizontalOptions="Center" />
				</StackLayout>

			</Grid>
		</ScrollView>

	</Grid>
</ContentPage>